<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employee ID Card Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

  <style>
    :root{
      --brand1:#1e3c72;
      --brand2:#2a5298;
      --ok:#16a34a;
      --err:#d32f2f;
      --ink:#0f172a;
    }
    body{
      margin:0; padding:24px;
      font-family:Cambria, serif;
      background:linear-gradient(135deg,var(--brand1),var(--brand2));
      color:#111827;
    }
    .shell{max-width:1200px; margin:0 auto; display:flex; gap:40px; flex-wrap:wrap; align-items:flex-start; justify-content:center;}
    .card{width:380px; background:#fff; border-radius:18px; padding:22px; box-shadow:0 18px 40px rgba(0,0,0,.22);}
    .title{margin:0 0 14px; font-weight:800; color:var(--brand1); text-align:center}
    .field{display:flex; flex-direction:column; gap:8px; margin:12px 0}
    .inp{border:1px solid #d1d5db; border-radius:12px; padding:12px 14px; font-size:16px;}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .btn{flex:1; min-width:160px; border:none; border-radius:12px; cursor:pointer; padding:12px 16px; font-weight:800; font-size:15px;}
    .btn-primary{background:var(--brand2); color:#fff}
    .btn-blue{background:#0059b2; color:#fff}
    .btn-green{background:var(--ok); color:#fff}
    .btn-outline{background:#fff; border:2px solid var(--ok); color:var(--ok)}
    .status{margin-top:10px; background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; display:flex; align-items:center; gap:8px;}
    .dot{width:10px; height:10px; border-radius:50%}
    .dot.gray{background:#cbd5e1} .dot.green{background:#22c55e} .dot.blue{background:#3b82f6}
    .preview{display:flex; flex-direction:column; align-items:center; gap:18px}
    .id-front,.id-back{width:420px; height:700px; border-radius:28px; overflow:hidden; box-shadow:0 10px 24px rgba(0,0,0,.28); background:#fff; position:relative; background-size:cover; background-position:center;}
    .id-front{ background-image:url('assets/front.png'); }
    .id-back{  background-image:url('assets/back.png'); }
    .frame{position:absolute; left:50%; top:220px; transform:translateX(-50%); width:140px; height:170px; border:6px solid #202c39; border-radius:16px; background:#fff; overflow:hidden; display:flex; align-items:center; justify-content:center;}
    .ph{color:#9ca3af; font-weight:700; letter-spacing:.1em}
    .info {
  position: absolute;
  top: 420px;
  left: 0;
  right: 0;
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: center;   /* center children without forcing widths */
  color: #fff;
  text-align: center;    /* optional for inner text alignment */
}

    .name{font-size:30px; font-weight:bold; margin-top:5px;}
    .pill {
  background: #fff;
  color: #103952;
  border-radius: 50px;
  padding: 2px 12px;
  font-size: 21px;
  font-weight: bold;
  display: inline-block;
  width: auto;          /* important */
  max-width: 100%;      /* optional: prevent overflow */
  text-align: center;
  white-space: nowrap;  /* prevents text from breaking */
}



    .role{font-size:21px; margin-top:4px;}
    .blood{font-size:21px; font-weight:bold; margin-top:4px;}
    .barcode{position:absolute; bottom:40px; left:0; right:0; text-align:center;}
    .barcode svg{width:250px !important; height:80px !important;}
  </style>
</head>
<body>
  <div class="shell">
    <!-- FORM -->
    <div class="card">
      <h2 class="title">Employee Details</h2>
      <div class="field"><label for="photo">Upload Photo</label><input id="photo" type="file" accept="image/*" class="inp" /></div>
      <div class="field"><label for="name">Full Name</label><input id="name" class="inp" type="text" /></div>
      <div class="field"><label for="role">Role</label><input id="role" class="inp" type="text" /></div>
      <div class="field"><label for="empid">Employee ID</label><input id="empid" class="inp" type="text" /></div>
      <div class="field">
        <label for="blood">Blood Group</label>
        <select id="blood" class="inp">
          <option value="">Select</option>
          <option>O+ (O Positive)</option>
          <option>O- (O Negative)</option>
          <option>A+ (A Positive)</option>
          <option>A- (A Negative)</option>
          <option>B+ (B Positive)</option>
          <option>B- (B Negative)</option>
          <option>AB+ (AB Positive)</option>
          <option>AB- (AB Negative)</option>
        </select>
      </div>
      <div class="actions">
        <button id="saveBtn" class="btn btn-primary" type="button">Save to Excel</button>
        <button id="excelBtn" class="btn btn-blue" type="button">Download Excel</button>
      </div>
      <div class="actions">
        <button id="pngBtn" class="btn btn-green" type="button">Download PNG</button>
        <button id="pdfBtn" class="btn btn-outline" type="button">Download PDF</button>
      </div>
      <div class="status" id="genStatus"><div class="dot gray" id="statusDot"></div><div id="statusText">Idle</div></div>
    </div>

    <!-- PREVIEW -->
    <div class="preview">
      <div class="id-front" id="cardFront">
        <div class="frame" id="photoFrame"><span class="ph" id="phText">PHOTO</span></div>
        <div class="info">
          <div class="name" id="prevName">—</div>
          <div class="role" id="prevRole">—</div>
          <div class="pill" id="prevId">ID No:</div>
          <div class="blood" id="prevBlood">Blood:</div>
        </div>
        <div class="barcode"><svg id="barcode"></svg></div>
      </div>
      <div class="id-back" id="cardBack"></div>
    </div>
  </div>

<script>
  const $=id=>document.getElementById(id);
  const inputs={name:$('name'), role:$('role'), empid:$('empid'), blood:$('blood'), photo:$('photo')};
  const prev={name:$('prevName'), role:$('prevRole'), id:$('prevId'), blood:$('prevBlood')};
  const frame=$('photoFrame'), phText=$('phText');

  // Update preview fields
  ['name','role','empid','blood'].forEach(k=>{
    inputs[k].addEventListener('input',()=>{
      if(k==='empid'){prev.id.textContent="ID No: "+(inputs[k].value||'—');}
      else if(k==='blood'){prev.blood.textContent="Blood: "+(inputs[k].value||'—');}
      else{prev[k].textContent=inputs[k].value||'—';}
      updateBarcode();
    });
  });

  // Upload photo
  inputs.photo.addEventListener('change', e=>{
    const f=e.target.files[0]; if(!f){frame.style.backgroundImage='none'; phText.style.display='block'; return;}
    const rdr=new FileReader();
    rdr.onload=()=>{frame.style.backgroundImage=`url(${rdr.result})`;frame.style.backgroundSize='cover';frame.style.backgroundPosition='center';phText.style.display='none';};
    rdr.readAsDataURL(f);
  });

  // Barcode
  function updateBarcode(){
    const code=(inputs.empid.value+" "+inputs.name.value).trim();
    if(code){JsBarcode("#barcode", code, {format:"CODE128", width:1, height:30, displayValue:false, font:"Cambria"});}
  }

  // Excel handling
  let excelData=[["Name","Role","ID","Blood Group"]];
  function saveToExcelRow(){
    excelData.push([inputs.name.value.trim(),inputs.role.value.trim(),inputs.empid.value.trim(),inputs.blood.value.trim()]);
  }
  $('saveBtn').onclick=()=>saveToExcelRow();
  $('excelBtn').onclick=()=>{const ws=XLSX.utils.aoa_to_sheet(excelData);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Entries");XLSX.writeFile(wb,"IDCardEntries.xlsx");};

  // Capture card as PNG/PDF
  async function captureNode(node){return await html2canvas(node,{scale:5,useCORS:true,backgroundColor:null});}
  $('pngBtn').onclick=async()=>{const canvas=await captureNode($('cardFront'));const url=canvas.toDataURL('image/png');const a=document.createElement('a');a.href=url;a.download=(inputs.name.value||'idcard')+'.png';a.click();};
  $('pdfBtn').onclick=async()=>{const fc=await captureNode($('cardFront'));const bc=await captureNode($('cardBack'));const pdf=new window.jspdf.jsPDF({orientation:'portrait',unit:'pt',format:[fc.width*0.75,fc.height*0.75]});pdf.addImage(fc.toDataURL('image/png'),'PNG',0,0,pdf.internal.pageSize.getWidth(),pdf.internal.pageSize.getHeight());pdf.addPage();pdf.addImage(bc.toDataURL('image/png'),'PNG',0,0,pdf.internal.pageSize.getWidth(),pdf.internal.pageSize.getHeight());pdf.save((inputs.name.value||'idcard')+'.pdf');};
</script>
</body>
</html>
